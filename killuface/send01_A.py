import struct,time,codecs

def xstr2byte(thestr):
    aa=[ord(c) for c in thestr]
    #print(aa)
    return struct.pack(str(len(aa))+'B',*aa)

def str2xstr(str_chg):
    ss=''
    str_chg_b=str_chg.encode('utf-8')
    for pp in struct.unpack(str(len(str_chg_b))+'B',str_chg_b):
        ss=ss+hex(pp)
    xstr=codecs.decode(ss.replace('0x',r'\x'), "unicode_escape")#整理成\x形式
    #print(xstr2byte(xstr).decode('utf-8'))
    return xstr

def makedata(pk00,pk01,title0=None,title1=None):
  
    #title0='\x00\x00\xd6\x1c\x00\x00\x01\x17'
    #title1='\x08\x03\x12\x21\x38\x34\x45\x30\x46\x34\x32\x38\x36\x37\x42\x38\x35\x32\x37\x41\x31\x36\x33\x30\x32\x35\x30\x37\x30\x38\x31\x38\x38\x37\x33\x38\x32\x18\xdc\xd9\x8e\x94\xb9\x2f\x3a\xe8\x01\x12\x01\x30\x18\xdc\xd9\x8e\x94\xb9\x2f\x22\xdb\x01\x10\xd9\x0d\x20\xc4\xb2\xd6\xaf\x98\xfe\x03\x2a\x10\x38\x34\x45\x30\x46\x34\x32\x38\x36\x37\x42\x38\x35\x32\x37\x41\x32\x08\x4d\x38\x32\x30\x35\x43\x5f\x57\x3a\x0a\x47\x44\x2d\x56\x35\x2e\x32\x30\x31\x35\x52\x20\x62\x31\x30\x64\x34\x65\x35\x34\x66\x38\x34\x37\x63\x31\x39\x35\x63\x37\x34\x36\x32\x30\x62\x65\x35\x65\x35\x62\x61\x64\x66\x32\x5a\x18\x31\x38\x36\x31\x31\x37\x33\x35\x36\x34\x36\x31\x35\x37\x37\x35\x33\x37\x30\x31\x35\x35\x32\x35\x62\x06\x31\x32\x33\x34\x35\x36\x6a\x20\x32\x42\x36\x42\x43\x32\x45\x41\x39\x33\x33\x35\x34\x43\x33\x36\x39\x32\x35\x31\x45\x38\x44\x43\x37\x43\x33\x35\x38\x37\x36\x43\x72\x20\x65\x66\x63\x37\x30\x34\x38\x35\x30\x63\x32\x64\x33\x31\x35\x62\x64\x31\x35\x64\x34\x65\x61\x38\x36\x32\x33\x34\x66\x64\x66\x35\x78\xdc\xd9\x8e\x94\xb9\x2f\x92\x01\x16\x0a\x0b\x73\x64\x6b\x5f\x76\x65\x72\x73\x69\x6f\x6e\x12\x07\x56\x32\x2e\x30\x2e\x30\x30'
    #4s(type) 16s(sn) 13s(time) 4s(pk01) 36s(unknow) 16s(sn) 194s(unknow)
    
    t = time.time()#生成时间戳
    nowtime=str(round(t * 1000))
    title2=title1.replace(title1[20:33],str2xstr(nowtime)) #改了时间

    #小包初始号
    pk01_str=str(pk01)
    if len(str(pk01))==1:
        pk01_str='000'+pk01_str
    elif len(str(pk01))==2:
        pk01_str='00'+pk01_str
    elif len(str(pk01))==3:
        pk01_str='0'+pk01_str        
    title3=title2.replace(title1[33:37],str2xstr(pk01_str) ) #改包号

    #重新封装(小包)
    newdata1=xstr2byte(title3)

    #封装大包数据
    newdata0=xstr2byte(title0[0:2])+struct.pack('H',pk00) +struct.pack('!I',len(title3)) #根据小包生成大包数据
    return  newdata0,newdata1

if __name__ == '__main__':
    #newdata0,newdata1=makedata(52,8)
    #print(newdata0)
    #print(newdata1)
    print(str2xstr('163'))
    