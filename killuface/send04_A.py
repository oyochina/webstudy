import struct,time,codecs

def xstr2byte(thestr):
    aa=[ord(c) for c in thestr]
    #print(aa)
    return struct.pack(str(len(aa))+'B',*aa)

def str2xstr(str_chg):
    ss=''
    str_chg_b=str_chg.encode('utf-8')
    for pp in struct.unpack(str(len(str_chg_b))+'B',str_chg_b):
        ss=ss+hex(pp)
    xstr=codecs.decode(ss.replace('0x',r'\x'), "unicode_escape")#整理成\x形式
    #print(xstr2byte(xstr).decode('utf-8'))
    return xstr


def makedata(pk00,pk01,title0=None,title1=None):
    pk00=pk00+3
    pk01=pk01+2
    #title0=b'\x00\x00\x3d\x00\x00\x00\x07\x39'
    #title1=b'\x08\x04\x12\x21\x38\x34\x45\x30\x46\x34\x32\x36\x35\x30\x45\x31\x31\x35\x30\x31\x31\x36\x33\x30\x31\x35\x32\x39\x39\x33\x34\x33\x33\x30\x30\x35\x35\x18\x99\xd5\xc2\xe5\xb8\x2f\x42\x8a\x0e\x12\x01\x30\x18\x99\xd5\xc2\xe5\xb8\x2f\x22\x10\x38\x34\x45\x30\x46\x34\x32\x36\x35\x30\x45\x31\x31\x35\x30\x31\x32\xeb\x0d\x08\x01\x1a\x18\x0a\x13\x72\x65\x63\x4e\x6f\x50\x65\x72\x43\x6f\x6d\x4d\x6f\x64\x65\x54\x79\x70\x65\x12\x01\x32\x1a\x15\x0a\x10\x69\x64\x43\x61\x72\x64\x46\x61\x63\x65\x45\x6e\x61\x62\x6c\x65\x12\x01\x32\x1a\x18\x0a\x13\x72\x65\x63\x53\x75\x63\x53\x61\x76\x65\x53\x70\x6f\x74\x49\x6d\x61\x67\x65\x12\x01\x32\x1a\x1d\x0a\x09\x64\x65\x76\x69\x63\x65\x4b\x65\x79\x12\x10\x38\x34\x45\x30\x46\x34\x32\x36\x35\x30\x45\x31\x31\x35\x30\x31\x1a\x20\x0a\x0a\x64\x65\x76\x69\x63\x65\x4e\x61\x6d\x65\x12\x12\x55\x46\x61\x63\x65\x35\xe7\xb3\xbb\xe8\x80\x83\xe5\x8b\xa4\xe6\x9c\xba\x1a\x18\x0a\x14\x72\x65\x63\x53\x75\x63\x57\x69\x65\x67\x61\x6e\x64\x43\x6f\x6e\x74\x65\x6e\x74\x12\x00\x1a\x13\x0a\x0c\x63\x6f\x6d\x52\x65\x6c\x61\x79\x54\x69\x6d\x65\x12\x03\x35\x30\x30\x1a\x0f\x0a\x0a\x63\x6f\x6d\x52\x65\x63\x52\x61\x6e\x6b\x12\x01\x32\x1a\x1a\x0a\x15\x72\x65\x63\x4e\x6f\x50\x65\x72\x53\x61\x76\x65\x53\x70\x6f\x74\x49\x6d\x61\x67\x65\x12\x01\x32\x1a\x1f\x0a\x1b\x72\x65\x63\x4e\x6f\x50\x65\x72\x44\x69\x73\x70\x6c\x61\x79\x54\x65\x78\x74\x32\x43\x6f\x6e\x74\x65\x6e\x74\x12\x00\x1a\x16\x0a\x11\x72\x65\x63\x53\x75\x63\x43\x6f\x6d\x4d\x6f\x64\x65\x54\x79\x70\x65\x12\x01\x31\x1a\x1d\x0a\x19\x72\x65\x63\x53\x75\x63\x44\x69\x73\x70\x6c\x61\x79\x54\x65\x78\x74\x31\x43\x6f\x6e\x74\x65\x6e\x74\x12\x00\x1a\x1c\x0a\x16\x73\x63\x72\x44\x69\x73\x70\x6c\x61\x79\x54\x65\x78\x74\x32\x43\x6f\x6e\x74\x65\x6e\x74\x12\x02\x2d\x31\x1a\x14\x0a\x0f\x72\x65\x63\x53\x75\x63\x52\x65\x6c\x61\x79\x54\x79\x70\x65\x12\x01\x31\x1a\x17\x0a\x12\x72\x65\x63\x46\x61\x69\x6c\x43\x6f\x6d\x4d\x6f\x64\x65\x54\x79\x70\x65\x12\x01\x32\x1a\x17\x0a\x12\x63\x6f\x6d\x52\x65\x63\x44\x69\x73\x74\x4d\x6f\x64\x65\x54\x79\x70\x65\x12\x01\x33\x1a\x15\x0a\x0f\x69\x64\x43\x61\x72\x64\x46\x61\x63\x65\x53\x63\x6f\x72\x65\x12\x02\x38\x30\x1a\x12\x0a\x0d\x72\x65\x63\x46\x61\x69\x6c\x45\x6e\x61\x62\x6c\x65\x12\x01\x31\x1a\x1a\x0a\x16\x72\x65\x63\x4e\x6f\x50\x65\x72\x54\x74\x73\x4d\x6f\x64\x65\x43\x6f\x6e\x74\x65\x6e\x74\x12\x00\x1a\x1d\x0a\x18\x72\x65\x63\x4e\x6f\x50\x65\x72\x44\x69\x73\x70\x6c\x61\x79\x54\x65\x78\x74\x32\x54\x79\x70\x65\x12\x01\x31\x1a\x19\x0a\x11\x69\x73\x53\x68\x6f\x77\x50\x65\x72\x73\x6f\x6e\x43\x6f\x75\x6e\x74\x12\x04\x74\x72\x75\x65\x1a\x19\x0a\x15\x72\x65\x63\x46\x61\x69\x6c\x43\x6f\x6d\x4d\x6f\x64\x65\x43\x6f\x6e\x74\x65\x6e\x74\x12\x00\x1a\x17\x0a\x12\x69\x64\x43\x61\x72\x64\x46\x61\x63\x65\x48\x61\x72\x64\x77\x61\x72\x65\x12\x01\x32\x1a\x0e\x0a\x09\x6c\x6f\x63\x61\x6c\x44\x61\x74\x61\x12\x01\x30\x1a\x15\x0a\x10\x72\x65\x63\x46\x61\x69\x6c\x52\x65\x6c\x61\x79\x54\x79\x70\x65\x12\x01\x32\x1a\x16\x0a\x11\x72\x65\x63\x4e\x6f\x50\x65\x72\x52\x65\x6c\x61\x79\x54\x79\x70\x65\x12\x01\x32\x1a\x14\x0a\x0f\x72\x65\x70\x65\x61\x74\x52\x65\x67\x45\x6e\x61\x62\x6c\x65\x12\x01\x32\x1a\x1d\x0a\x18\x72\x65\x63\x4e\x6f\x50\x65\x72\x44\x69\x73\x70\x6c\x61\x79\x54\x65\x78\x74\x31\x54\x79\x70\x65\x12\x01\x31\x1a\x1a\x0a\x16\x72\x65\x63\x4e\x6f\x50\x65\x72\x57\x69\x65\x67\x61\x6e\x64\x43\x6f\x6e\x74\x65\x6e\x74\x12\x00\x1a\x11\x0a\x0c\x63\x61\x72\x64\x46\x61\x63\x65\x49\x6e\x74\x66\x12\x01\x32\x1a\x0f\x0a\x09\x66\x61\x63\x65\x53\x63\x6f\x72\x65\x12\x02\x38\x30\x1a\x15\x0a\x10\x63\x6f\x6d\x52\x65\x63\x54\x69\x6d\x65\x57\x69\x6e\x64\x6f\x77\x12\x01\x30\x1a\x1d\x0a\x19\x72\x65\x63\x53\x75\x63\x44\x69\x73\x70\x6c\x61\x79\x54\x65\x78\x74\x32\x43\x6f\x6e\x74\x65\x6e\x74\x12\x00\x1a\x11\x0a\x08\x74\x69\x6d\x65\x5a\x6f\x6e\x65\x12\x05\x47\x4d\x54\x2b\x38\x1a\x13\x0a\x0b\x72\x65\x67\x49\x6e\x74\x65\x72\x76\x61\x6c\x12\x04\x32\x30\x30\x30\x1a\x1b\x0a\x16\x72\x65\x63\x53\x75\x63\x44\x69\x73\x70\x6c\x61\x79\x54\x65\x78\x74\x32\x54\x79\x70\x65\x12\x01\x31\x1a\x18\x0a\x13\x72\x65\x63\x4e\x6f\x50\x65\x72\x57\x69\x65\x67\x61\x6e\x64\x54\x79\x70\x65\x12\x01\x31\x1a\x19\x0a\x14\x72\x65\x63\x46\x61\x69\x6c\x53\x61\x76\x65\x53\x70\x6f\x74\x49\x6d\x61\x67\x65\x12\x01\x32\x1a\x11\x0a\x07\x62\x69\x6e\x64\x50\x77\x64\x12\x06\x31\x32\x33\x34\x35\x36\x1a\x13\x0a\x0e\x63\x61\x72\x64\x46\x61\x63\x65\x45\x6e\x61\x62\x6c\x65\x12\x01\x32\x1a\x18\x0a\x13\x72\x65\x63\x4e\x6f\x50\x65\x72\x54\x74\x73\x4d\x6f\x64\x65\x54\x79\x70\x65\x12\x01\x31\x1a\x0d\x0a\x08\x63\x61\x72\x64\x49\x6e\x74\x66\x12\x01\x32\x1a\x1b\x0a\x16\x72\x65\x63\x53\x75\x63\x44\x69\x73\x70\x6c\x61\x79\x54\x65\x78\x74\x31\x54\x79\x70\x65\x12\x01\x31\x1a\x1a\x0a\x13\x73\x63\x72\x44\x69\x73\x70\x6c\x61\x79\x54\x65\x78\x74\x32\x54\x79\x70\x65\x12\x03\x31\x30\x30\x1a\x18\x0a\x14\x72\x65\x63\x53\x75\x63\x43\x6f\x6d\x4d\x6f\x64\x65\x43\x6f\x6e\x74\x65\x6e\x74\x12\x00\x1a\x19\x0a\x15\x72\x65\x63\x46\x61\x69\x6c\x54\x74\x73\x4d\x6f\x64\x65\x43\x6f\x6e\x74\x65\x6e\x74\x12\x00\x1a\x1d\x0a\x18\x69\x64\x43\x61\x72\x64\x56\x65\x72\x69\x66\x69\x63\x61\x74\x69\x6f\x6e\x45\x6e\x61\x62\x6c\x65\x12\x01\x31\x1a\x16\x0a\x11\x72\x65\x63\x53\x75\x63\x57\x69\x65\x67\x61\x6e\x64\x54\x79\x70\x65\x12\x01\x31\x1a\x16\x0a\x11\x66\x61\x63\x65\x44\x65\x74\x65\x63\x74\x69\x6f\x6e\x54\x79\x70\x65\x12\x01\x31\x1a\x0f\x0a\x0a\x63\x61\x72\x64\x45\x6e\x61\x62\x6c\x65\x12\x01\x31\x1a\x17\x0a\x0f\x69\x73\x53\x68\x6f\x77\x44\x65\x76\x69\x63\x65\x4b\x65\x79\x12\x04\x74\x72\x75\x65\x1a\x13\x0a\x0e\x69\x64\x43\x61\x72\x64\x46\x61\x63\x65\x49\x6e\x74\x66\x12\x01\x33\x1a\x16\x0a\x11\x72\x65\x63\x53\x75\x63\x54\x74\x73\x4d\x6f\x64\x65\x54\x79\x70\x65\x12\x01\x31\x1a\x1a\x0a\x15\x72\x65\x63\x46\x61\x69\x6c\x54\x69\x6d\x65\x73\x54\x68\x72\x65\x73\x68\x6f\x6c\x64\x12\x01\x33\x1a\x1b\x0a\x16\x72\x65\x63\x46\x61\x69\x6c\x44\x69\x73\x70\x6c\x61\x79\x54\x65\x78\x74\x54\x79\x70\x65\x12\x01\x31\x1a\x18\x0a\x13\x73\x63\x72\x44\x69\x73\x70\x6c\x61\x79\x54\x65\x78\x74\x31\x54\x79\x70\x65\x12\x01\x31\x1a\x17\x0a\x12\x72\x65\x63\x46\x61\x69\x6c\x57\x69\x65\x67\x61\x6e\x64\x54\x79\x70\x65\x12\x01\x31\x1a\x11\x0a\x0c\x63\x61\x72\x64\x48\x61\x72\x64\x77\x61\x72\x65\x12\x01\x31\x1a\x19\x0a\x15\x72\x65\x63\x46\x61\x69\x6c\x57\x69\x65\x67\x61\x6e\x64\x43\x6f\x6e\x74\x65\x6e\x74\x12\x00\x1a\x1f\x0a\x1b\x72\x65\x63\x4e\x6f\x50\x65\x72\x44\x69\x73\x70\x6c\x61\x79\x54\x65\x78\x74\x31\x43\x6f\x6e\x74\x65\x6e\x74\x12\x00\x1a\x1a\x0a\x16\x73\x63\x72\x44\x69\x73\x70\x6c\x61\x79\x54\x65\x78\x74\x31\x43\x6f\x6e\x74\x65\x6e\x74\x12\x00\x1a\x17\x0a\x12\x72\x65\x63\x46\x61\x69\x6c\x54\x74\x73\x4d\x6f\x64\x65\x54\x79\x70\x65\x12\x01\x31\x1a\x1a\x0a\x15\x72\x65\x63\x44\x69\x73\x70\x6c\x61\x79\x52\x65\x67\x69\x73\x74\x65\x72\x50\x69\x63\x12\x01\x31\x1a\x0f\x0a\x0a\x66\x61\x63\x65\x45\x6e\x61\x62\x6c\x65\x12\x01\x31\x1a\x1d\x0a\x19\x72\x65\x63\x46\x61\x69\x6c\x44\x69\x73\x70\x6c\x61\x79\x54\x65\x78\x74\x43\x6f\x6e\x74\x65\x6e\x74\x12\x00\x1a\x10\x0a\x08\x69\x73\x53\x68\x6f\x77\x49\x70\x12\x04\x74\x72\x75\x65\x1a\x18\x0a\x14\x72\x65\x63\x53\x75\x63\x54\x74\x73\x4d\x6f\x64\x65\x43\x6f\x6e\x74\x65\x6e\x74\x12\x00\x1a\x13\x0a\x0f\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x4e\x61\x6d\x65\x12\x00\x1a\x13\x0a\x0d\x63\x61\x72\x64\x46\x61\x63\x65\x53\x63\x6f\x72\x65\x12\x02\x36\x30\x1a\x1a\x0a\x16\x72\x65\x63\x4e\x6f\x50\x65\x72\x43\x6f\x6d\x4d\x6f\x64\x65\x43\x6f\x6e\x74\x65\x6e\x74\x12\x00\x1a\x15\x0a\x0c\x6c\x61\x6e\x67\x75\x61\x67\x65\x54\x79\x70\x65\x12\x05\x7a\x68\x5f\x43\x4e'

    #解包(小包)
    #b=struct.unpack('4s16s13s4s22s16s95s16s1663s',title1) 
    # 4s 16s(sn) 13s(time) 4s(pknum) 22s(unknow) 16s(sn) 95s(unknow) 16s(sn) 1663s(unknow)（tuple格式）

    t = time.time()#生成时间戳
    nowtime=str(round(t * 1000))    
    title2=title1.replace(title1[20:33],str2xstr(nowtime)) #改了时间

    #小包初始号
    pk01_str=str(pk01)
    if len(str(pk01))==1:
        pk01_str='000'+pk01_str
    elif len(str(pk01))==2:
        pk01_str='00'+pk01_str
    elif len(str(pk01))==3:
        pk01_str='0'+pk01_str        
    title3=title2.replace(title1[33:37],str2xstr(pk01_str) ) #改包号

    #重新封装(小包)
    newdata1=xstr2byte(title3)

    #封装大包数据
    newdata0=xstr2byte(title0[0:2])+struct.pack('H',pk00) +struct.pack('!I',len(title3)) #根据小包生成大包数据

    return  newdata0,newdata1